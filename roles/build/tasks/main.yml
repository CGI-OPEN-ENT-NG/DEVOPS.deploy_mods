---
  - name: Creates inventory hostname workspace
    file: path=workspace/{{ inventory_hostname }} state=directory
  
  - name: Cloning module projects
    with_dict: "{{ mods }}"
    git:
      repo: "{{ item.value.repository }}"
      dest: "{{ playbook_dir }}/workspace/{{ inventory_hostname }}/{{ item.key }}"
      version: "{{ item.value.branch }}"

  - name: Building project
    with_dict: "{{ mods }}"
    shell: . ~/.bashrc && ./build.sh install
    args:
      chdir: "{{ playbook_dir }}/workspace/{{ inventory_hostname }}/{{ item.key }}"
    register: build_result
    failed_when: ("'ERR' in build_result.stderr") or
                 ("'FAILED' in build_result.stderr")
...